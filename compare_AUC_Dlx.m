%% set datapaths for each group
    
Dlx_RITE = {{'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 1/day 0/T8';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 1/day 3/T8';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 1/day 7/T8'},...
            {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 2/day 0/T9';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 2/day 3/T9_rigid';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 2/day 7/T9'},...
            {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 3/day 0/10';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 3/day 3/T10';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 3/day 7/T10'},...
            {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 4/day 0/T11';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 4/day 3/T11';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 4/day 7/T11'},...
            {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 5/day 0/T';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 5/day 3/T';...
             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE/Mouse 5/day 7/T'}};

Dlx_Ion_CC = {{'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 1/day 0/T1';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 1/day 3/T1';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 1/day 7/T1'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 2/day 0/T2';...   
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 2/day 3/T2';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 2/day 7/T2'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 3/day 0/T3';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 3/day 3/T3';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 3/day 7/T3'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 4/day 0/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 4/day 3/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 4/day 7/T'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 5/day 0/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 5/day 3/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 5/day 7/T'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 6/day 0/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 6/day 3/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/IoN-CCI/Mouse 6/day 7/T'}};

 Dlx_Sham = {{'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 1/day 0/T4_rigid';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 1/day 3/T4';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 1/day 7/T4'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 2/day 0/T5';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 2/day 3/T5';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 2/day 7/T5'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 3/day 0/T6_rigid';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 3/day 3/T6';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 3/day 7/T6'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 4/day 0/T7_rigid';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 4/day 3/T7';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 4/day 7/T7'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 5/day 0/T_rigid';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 5/day 3/T_rigid';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 5/day 7/T'},...
              {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 6/day 0/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 6/day 3/T';...
               'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 6/day 7/T'}};



%% 2-wAY ANOVA for FLIT and Sham only
     
norm_res = true; % normalize AUC of each animal

[frac_global_RITE,num_transients_RITE,global_AUC_RITE,ind_AUC_RITE,sum_events_RITE,tot_AUC_RITE,trace_AUC_RITE] = group_graphs(Dlx_RITE, norm_res);
[frac_global_SHAM,num_transients_SHAM,global_AUC_SHAM,ind_AUC_SHAM,sum_events_SHAM,tot_AUC_SHAM,trace_AUC_SHAM] = group_graphs(Dlx_Sham, norm_res);

y_vals = [reshape(trace_AUC_RITE.',1,[]), reshape(trace_AUC_SHAM.',1,[])];
groups{1} = repmat({'d1','d3','d7'}, 1, size(trace_AUC_RITE,1) + size(trace_AUC_SHAM,1));
groups{2} = [repmat({'RITE'}, 1, size(trace_AUC_RITE(:),1)), repmat({'SHAM'}, 1, size(trace_AUC_SHAM(:),1)) ] ;

[p,tbl,stats] = anovan(y_vals, groups, 'model','interaction','varnames',{'Days','Groups'});
figure;
results = multcompare(stats,'Dimension',[1 2], 'CType' ,'tukey-kramer')

%% 2-Way ANOVA and bootstrap difference on groups
norm_res = true; % normalize AUC of each animal

[frac_global_RITE,num_transients_RITE,global_AUC_RITE,ind_AUC_RITE,sum_events_RITE,tot_AUC_RITE,trace_AUC_RITE] = group_graphs(Dlx_RITE, norm_res);
[frac_global_IONCC,num_transients_IONCC,global_AUC_IONCC,ind_AUC_IONCC,sum_events_IONCC,tot_AUC_IONCC,trace_AUC_IONCC] = group_graphs(Dlx_Ion_CC, norm_res);
[frac_global_SHAM,num_transients_SHAM,global_AUC_SHAM,ind_AUC_SHAM,sum_events_SHAM,tot_AUC_SHAM,trace_AUC_SHAM] = group_graphs(Dlx_Sham, norm_res);

y_vals = [reshape(trace_AUC_RITE.',1,[]), reshape(trace_AUC_IONCC.',1,[]), reshape(trace_AUC_SHAM.',1,[])];
groups{1} = repmat({'d1','d3','d7'}, 1, size(trace_AUC_RITE,1) + size(trace_AUC_IONCC,1) + size(trace_AUC_SHAM,1));
groups{2} = [repmat({'RITE'}, 1, size(trace_AUC_RITE(:),1)), repmat({'IONCC'}, 1, size(trace_AUC_IONCC(:),1)), repmat({'SHAM'}, 1, size(trace_AUC_SHAM(:),1)) ] ;

[p,tbl,stats] = anovan(y_vals, groups, 'model','interaction','varnames',{'Days','Groups'});
figure;
results = multcompare(stats,'Dimension',[1 2], 'CType' ,'tukey-kramer')



num_shuffles = 10000;

p_d1_RITE_IONCC = bootstrap_mean_diff(trace_AUC_RITE(:,1), trace_AUC_IONCC(:,1), num_shuffles);
p_d1_RITE_SHAM = bootstrap_mean_diff(trace_AUC_RITE(:,1), trace_AUC_SHAM(:,1), num_shuffles);
p_d1_IONCC_SHAM = bootstrap_mean_diff(trace_AUC_IONCC(:,1), trace_AUC_SHAM(:,1), num_shuffles);

p_d2_RITE_IONCC = bootstrap_mean_diff(trace_AUC_RITE(:,2), trace_AUC_IONCC(:,2), num_shuffles);
p_d2_RITE_SHAM = bootstrap_mean_diff(trace_AUC_RITE(:,2), trace_AUC_SHAM(:,2), num_shuffles);
p_d2_IONCC_SHAM = bootstrap_mean_diff(trace_AUC_IONCC(:,2), trace_AUC_SHAM(:,2), num_shuffles);

p_d3_RITE_IONCC = bootstrap_mean_diff(trace_AUC_RITE(:,3), trace_AUC_IONCC(:,3), num_shuffles);
p_d3_RITE_SHAM = bootstrap_mean_diff(trace_AUC_RITE(:,3), trace_AUC_SHAM(:,3), num_shuffles);
p_d3_IONCC_SHAM = bootstrap_mean_diff(trace_AUC_IONCC(:,3), trace_AUC_SHAM(:,3), num_shuffles);

% p_d1_RITE_ALLCONT = bootstrap_mean_diff(trace_AUC_RITE(:,1), [trace_AUC_IONCC(:,1); trace_AUC_SHAM(:,1)], num_shuffles);
% p_d2_RITE_ALLCONT = bootstrap_mean_diff(trace_AUC_RITE(:,2), [trace_AUC_IONCC(:,2); trace_AUC_SHAM(:,2)], num_shuffles);
% p_d3_RITE_ALLCONT = bootstrap_mean_diff(trace_AUC_RITE(:,3), [trace_AUC_IONCC(:,3); trace_AUC_SHAM(:,3)], num_shuffles);

bonferroni_alpha = 0.05 / 9;

% figure;
% errorbar(mean(trace_AUC_RITE,1), std(trace_AUC_RITE,1)/sqrt(5) ,'LineWidth',3, 'Color', 'r');
% hold on;
% errorbar(mean(trace_AUC_IONCC,1), std(trace_AUC_IONCC,1)/sqrt(6) ,'LineWidth',3, 'Color', 'b');
% errorbar(mean(trace_AUC_SHAM,1), std(trace_AUC_SHAM,1)/sqrt(4) ,'LineWidth',3, 'Color', 'k');
% hold off;

% figure;
% errorbar(mean(trace_AUC_RITE,1), std(trace_AUC_RITE,1)/sqrt(5) ,'LineWidth',3, 'Color', 'r');
% hold on;
% errorbar(mean([trace_AUC_IONCC;trace_AUC_SHAM],1), std([trace_AUC_IONCC;trace_AUC_SHAM],1)/sqrt(10) ,'LineWidth',3, 'Color', 'k');
% hold off;

% ylabel('AUC');
% set(gca,'box','off','color','none', 'TickDir','out', 'fontsize',14);
% yticks([0,0.1,0.2,0.3,0.4,0.5]);
% yticklabels({'0','0.1','0.2','0.3','0.4','0.5'});
% xticks([1,2,3]);
% xticklabels({'Day 0','Day 3','Day 7'});
% xtickangle(45);
% xlim([0.8,3.2]);
% ylim([0,1]);
% legend('RITE','ION-CC','SHAM');

% figure; 
% errorbar(mean(trace_AUC_RITE,1), std(trace_AUC_RITE,1)/sqrt(5) ,'LineWidth',3, 'Color', 'r', 'CapSize',0); %, 'Marker', 's', 'MarkerSize', 12, 'MarkerFaceColor', 'w'
% hold on;
% errorbar(mean(trace_AUC_IONCC,1), std(trace_AUC_IONCC,1)/sqrt(6) ,'LineWidth',3, 'Color', 'b', 'CapSize',0); % ,'Marker', '^', 'MarkerSize', 12, 'MarkerFaceColor', 'w'
% errorbar(mean(trace_AUC_SHAM,1), std(trace_AUC_SHAM,1)/sqrt(6) ,'LineWidth',3, 'Color', '#008000', 'CapSize',0); % ,'Marker', 'o', 'MarkerSize', 12, 'MarkerFaceColor', 'w'
% hold off;

f = figure('units','inches','position',[2,2,1.2,1.9]);
ax = subplot(1,1,1);
plot(mean(trace_AUC_RITE,1),'LineWidth',1, 'Color', '#FF0000', 'MarkerSize', 3, 'Marker', 'o', 'MarkerFaceColor', '#FF0000', 'MarkerEdgeColor', 'none'); %, 'Marker', 's', 'MarkerSize', 12, 'MarkerFaceColor', 'w'
hold on;
plot(mean(trace_AUC_IONCC,1),'LineWidth',1, 'Color', '#0000FF', 'MarkerSize', 3, 'Marker', 'o', 'MarkerFaceColor', '#0000FF', 'MarkerEdgeColor', 'none');
plot(mean(trace_AUC_SHAM,1),'LineWidth',1, 'Color', '#008000', 'MarkerSize', 3, 'Marker', 'o', 'MarkerFaceColor', '#008000', 'MarkerEdgeColor', 'none');
plot_shade(ax, [1,2,3], trace_AUC_RITE', '#FF0000');
plot_shade(ax, [1,2,3], trace_AUC_IONCC', '#0000FF');
plot_shade(ax, [1,2,3], trace_AUC_SHAM', '#008000');
% ylim([0,0.7]);
% xlim([1,3]);
hold off;

plot_appearance(ax);

% pbaspect([1 3.5 1]);
ylabel('AUC');
set(gca,'box','off','color','none', 'TickDir','out');
yticks([0,0.25,0.5,0.75,1]);
yticklabels({'0','0.25','0.5','0.75','1'});
xticks([1,2,3]);
xticklabels({'0','3','7'});
xlabel('Days post surgery')
xlim([0.8,3]);
ylim([0,1]);
% legend('RITE','ION-CC','SHAM');

saveas(f,'Dlx AUC','svg');

% figure;
% errorbar(mean(sum_events_RITE,1), std(sum_events_RITE,1)/sqrt(5) ,'LineWidth',3, 'Color', 'r');
% hold on;
% errorbar(mean(sum_events_IONCC,1), std(sum_events_IONCC,1)/sqrt(6) ,'LineWidth',3, 'Color', 'b');
% errorbar(mean(sum_events_SHAM,1), std(sum_events_SHAM,1)/sqrt(6) ,'LineWidth',3, 'Color', 'k');
% hold off;
% 
% pbaspect([1 2 1]);
% ylabel('AUC');
% set(gca,'box','off','color','none', 'TickDir','out', 'fontsize',14);
% % yticks([0,0.1,0.2,0.3,0.4,0.5]);
% % yticklabels({'0','0.1','0.2','0.3','0.4','0.5'});
% xticks([1,2,3]);
% xticklabels({'0','3','7'});
% xlabel('Days post surgery')
% xlim([0.8,3.2]);
% % ylim([0.3,1]);


% figure;
% errorbar(mean(frac_global_RITE,1), std(frac_global_RITE,1)/sqrt(5) ,'LineWidth',3, 'Color', 'r');
% hold on;
% errorbar(mean(frac_global_IONCC,1), std(frac_global_IONCC,1)/sqrt(6) ,'LineWidth',3, 'Color', 'b');
% errorbar(mean(frac_global_SHAM,1), std(frac_global_SHAM,1)/sqrt(4) ,'LineWidth',3, 'Color', 'k');
% hold off;
% 
% ylabel('AUC');
% set(gca,'box','off','color','none', 'TickDir','out', 'fontsize',14);
% % yticks([0,0.1,0.2,0.3,0.4,0.5]);
% % yticklabels({'0','0.1','0.2','0.3','0.4','0.5'});
% xticks([1,2,3]);
% xticklabels({'Day 0','Day 3','Day 7'});
% xtickangle(45);
% xlim([0.8,3.2]);
% legend('RITE','ION-CC','SHAM');

%% AUC analysis for each neuron
roi_AUC_RITE = get_trace_AUC(Dlx_RITE);
roi_AUC_IONCC = get_trace_AUC(Dlx_Ion_CC);
roi_AUC_SHAM = get_trace_AUC(Dlx_Sham);

% group all the data by experimental group
auc_rois = cell(size(roi_AUC_RITE,2));
for i=1:size(roi_AUC_RITE,2)
    for j=1:size(roi_AUC_RITE,1)
        auc_rois{1,i} = [auc_rois{1,i}, roi_AUC_RITE{j,i}];
    end
    for j=1:size(roi_AUC_IONCC,1)
        auc_rois{2,i} = [auc_rois{2,i}, roi_AUC_IONCC{j,i}];
    end
    for j=1:size(roi_AUC_SHAM,1)
        auc_rois{3,i} = [auc_rois{3,i}, roi_AUC_SHAM{j,i}];
    end
end

% set up 2-Way ANOVA
% y_vals = [reshape(trace_AUC_RITE.',1,[]), reshape(trace_AUC_IONCC.',1,[]), reshape(trace_AUC_SHAM.',1,[])];
y_vals = [auc_rois{1,1},auc_rois{1,2},auc_rois{1,3},auc_rois{2,1},auc_rois{2,2},auc_rois{2,3},auc_rois{3,1},auc_rois{3,2},auc_rois{3,3}];
groups{1} = [repmat({'d1'}, 1, length(auc_rois{1,1})), repmat({'d2'}, 1, length(auc_rois{1,2})), repmat({'d3'}, 1, length(auc_rois{1,3})),...
             repmat({'d1'}, 1, length(auc_rois{2,1})), repmat({'d2'}, 1, length(auc_rois{2,2})), repmat({'d3'}, 1, length(auc_rois{2,3})),...
             repmat({'d1'}, 1, length(auc_rois{3,1})), repmat({'d2'}, 1, length(auc_rois{3,2})), repmat({'d3'}, 1, length(auc_rois{3,3}))];
% groups{2} = [repmat({'RITE'}, 1, length(auc_rois{1,1}) + length(auc_rois{1,2}) + length(auc_rois{1,3})),...
%              repmat({'IONCC'}, 1, length(auc_rois{2,1}) + length(auc_rois{2,2}) + length(auc_rois{2,3})),...
%              repmat({'SHAM'}, 1, length(auc_rois{3,1}) + length(auc_rois{3,2}) + length(auc_rois{3,3}))];
         
groups{2} = [repmat({'RITE'}, 1, length(auc_rois{1,1}) + length(auc_rois{1,2}) + length(auc_rois{1,3})),...
             repmat({'SHAM'}, 1, length(auc_rois{2,1}) + length(auc_rois{2,2}) + length(auc_rois{2,3})),...
             repmat({'SHAM'}, 1, length(auc_rois{3,1}) + length(auc_rois{3,2}) + length(auc_rois{3,3}))];

[p,tbl,stats] = anovan(y_vals, groups, 'model','interaction','varnames',{'Days','Groups'});
figure;
results = multcompare(stats,'Dimension',[1 2]);

%% run bootstrap mean difference test
roi_AUC_RITE = get_trace_AUC(Dlx_RITE);
roi_AUC_IONCC = get_trace_AUC(Dlx_Ion_CC);
roi_AUC_SHAM = get_trace_AUC(Dlx_Sham);

% group all the data by experimental group
auc_rois = cell(size(roi_AUC_RITE,2));
for i=1:size(roi_AUC_RITE,2)
    for j=1:size(roi_AUC_RITE,1)
        auc_rois{1,i} = [auc_rois{1,i}, roi_AUC_RITE{j,i}];
    end
    for j=1:size(roi_AUC_IONCC,1)
        auc_rois{2,i} = [auc_rois{2,i}, roi_AUC_IONCC{j,i}];
    end
    for j=1:size(roi_AUC_SHAM,1)
        auc_rois{3,i} = [auc_rois{3,i}, roi_AUC_SHAM{j,i}];
    end
end


num_shuffles = 10000;

p_d1_in_RITE_IONCC = bootstrap_mean_diff(auc_rois{1,1}, auc_rois{2,1}, num_shuffles);
p_d1_in_RITE_SHAM = bootstrap_mean_diff(auc_rois{1,1}, auc_rois{3,1}, num_shuffles);
p_d1_in_IONCC_SHAM = bootstrap_mean_diff(auc_rois{2,1}, auc_rois{3,1}, num_shuffles);

p_d2_in_RITE_IONCC = bootstrap_mean_diff(auc_rois{1,2}, auc_rois{2,2}, num_shuffles);
p_d2_in_RITE_SHAM = bootstrap_mean_diff(auc_rois{1,2}, auc_rois{3,2}, num_shuffles);
p_d2_in_IONCC_SHAM = bootstrap_mean_diff(auc_rois{2,2}, auc_rois{3,2}, num_shuffles);

p_d3_in_RITE_IONCC = bootstrap_mean_diff(auc_rois{1,3}, auc_rois{2,3}, num_shuffles);
p_d3_in_RITE_SHAM = bootstrap_mean_diff(auc_rois{1,3}, auc_rois{3,3}, num_shuffles);
p_d3_in_IONCC_SHAM = bootstrap_mean_diff(auc_rois{2,3}, auc_rois{3,3}, num_shuffles);

bonferroni_alpha = 0.05 / 9;

figure;
errorbar([mean(auc_rois{1,1}),mean(auc_rois{1,2}),mean(auc_rois{1,3})], [std(auc_rois{1,1})/sqrt(size(auc_rois{1,1},2)), std(auc_rois{1,2})/sqrt(size(auc_rois{1,2},2)), std(auc_rois{1,3})/sqrt(size(auc_rois{1,3},2))] ,'LineWidth',3, 'Color', 'r');
hold on;
errorbar([mean(auc_rois{2,1}),mean(auc_rois{2,2}),mean(auc_rois{2,3})], [std(auc_rois{2,1})/sqrt(size(auc_rois{2,1},2)), std(auc_rois{2,2})/sqrt(size(auc_rois{2,2},2)), std(auc_rois{2,3})/sqrt(size(auc_rois{2,3},2))] ,'LineWidth',3, 'Color', 'b');
errorbar([mean(auc_rois{3,1}),mean(auc_rois{3,2}),mean(auc_rois{3,3})], [std(auc_rois{3,1})/sqrt(size(auc_rois{3,1},2)), std(auc_rois{3,2})/sqrt(size(auc_rois{3,2},2)), std(auc_rois{3,3})/sqrt(size(auc_rois{3,3},2))] ,'LineWidth',3, 'Color', 'k');
hold off;

ylabel('AUC');
set(gca,'box','off','color','none', 'TickDir','out', 'fontsize',14);
% yticks([0,0.1,0.2,0.3,0.4,0.5]);
% yticklabels({'0','0.1','0.2','0.3','0.4','0.5'});
xticks([1,2,3]);
xticklabels({'Day 0','Day 3','Day 7'});
xtickangle(45);
xlim([0.8,3.2]);
ylim([0,1]);
legend('RITE','ION-CC','SHAM');

%% 2-Way ANOVA test

% y_vals = [trace_AUC_m1,trace_AUC_m2,trace_AUC_m3,trace_AUC_m4,trace_AUC_m5,...
%           trace_AUC_ioncc_m1,trace_AUC_ioncc_m2,trace_AUC_ioncc_m3,trace_AUC_ioncc_m4,trace_AUC_ioncc_m5,trace_AUC_ioncc_m6,...
%           trace_AUC_sham_m1,trace_AUC_sham_m2,trace_AUC_sham_m3,trace_AUC_sham_m4,trace_AUC_sham_m5,trace_AUC_sham_m6,trace_AUC_sham_m7];




% groups{1} = {'d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3',...
%              'd1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3',...
%              'd1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3'};
% groups{2} = {'m1','m1','m1','m2','m2','m2','m3','m3','m3','m4','m4','m4','m5','m5','m5',...
%              'm6','m6','m6','m7','m7','m7','m8','m8','m8','m9','m9','m9','m10','m10','m10',...
%              'm11','m11','m11','m12','m12','m12','m13','m13','m13','m14','m14','m14','m15','m15','m15'};
% groups{2} = {'RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE',...
%              'IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC'...,'IONCC','IONCC','IONCC',...
%              'SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM'};%,'SHAM','SHAM','SHAM','SHAM','SHAM','SHAM'};
% 
% groups{2} = {'RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE',...
%              'CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL',...
%              'CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL'};




%%


%     anova2_mat = [trace_AUC_m1;...
%                   trace_AUC_m2;...
%                   trace_AUC_m3;...
%                   trace_AUC_m4;...
%                   trace_AUC_m5;...
%                   trace_AUC_ioncc_m1;...
%                   trace_AUC_ioncc_m2;...                 
%                   trace_AUC_ioncc_m3;...                  
%                   trace_AUC_ioncc_m4;...
%                   trace_AUC_ioncc_m5];
% 
%     [p,tbl,stats] = anova2(anova2_mat,5); 
%     figure
%     multcompare(stats)

% Bootstrap test
disp('bootstrap test...');
%     Bootstrap_test([trace_AUC_ioncc_m1(1),trace_AUC_ioncc_m2(1),trace_AUC_ioncc_m3(1),trace_AUC_ioncc_m4(1),trace_AUC_ioncc_m5(1)], [trace_AUC_m1(1),trace_AUC_m2(1),trace_AUC_m3(1),trace_AUC_m4(1),trace_AUC_m5(1)]);
%     Bootstrap_test([trace_AUC_ioncc_m1(2),trace_AUC_ioncc_m2(2),trace_AUC_ioncc_m3(2),trace_AUC_ioncc_m4(2),trace_AUC_ioncc_m5(2)], [trace_AUC_m1(2),trace_AUC_m2(2),trace_AUC_m3(2),trace_AUC_m4(2),trace_AUC_m5(2)]);
%     Bootstrap_test([trace_AUC_ioncc_m1(3),trace_AUC_ioncc_m2(3),trace_AUC_ioncc_m3(3),trace_AUC_ioncc_m4(3),trace_AUC_ioncc_m5(3)], [trace_AUC_m1(3),trace_AUC_m2(3),trace_AUC_m3(3),trace_AUC_m4(3),trace_AUC_m5(3)]);

Bootstrap_test([trace_AUC_sham_m1(1),trace_AUC_sham_m2(1),trace_AUC_sham_m3(1),trace_AUC_sham_m4(1),trace_AUC_sham_m5(1),trace_AUC_sham_m6(1),trace_AUC_sham_m7(1)], [trace_AUC_m1(1),trace_AUC_m2(1),trace_AUC_m3(1),trace_AUC_m4(1),trace_AUC_m5(1)]);
Bootstrap_test([trace_AUC_sham_m1(2),trace_AUC_sham_m2(2),trace_AUC_sham_m3(2),trace_AUC_sham_m4(2),trace_AUC_sham_m5(2),trace_AUC_sham_m6(2),trace_AUC_sham_m7(2)], [trace_AUC_m1(2),trace_AUC_m2(2),trace_AUC_m3(2),trace_AUC_m4(2),trace_AUC_m5(2)]);
Bootstrap_test([trace_AUC_sham_m1(3),trace_AUC_sham_m2(3),trace_AUC_sham_m3(3),trace_AUC_sham_m4(3),trace_AUC_sham_m5(3),trace_AUC_sham_m6(3),trace_AUC_sham_m7(3)], [trace_AUC_m1(3),trace_AUC_m2(3),trace_AUC_m3(3),trace_AUC_m4(3),trace_AUC_m5(3)]);

% ANOVA analysis
y_vals = [trace_AUC_m1,trace_AUC_m2,trace_AUC_m3,trace_AUC_m4,trace_AUC_m5,...
          trace_AUC_ioncc_m1,trace_AUC_ioncc_m2,trace_AUC_ioncc_m3,trace_AUC_ioncc_m4,trace_AUC_ioncc_m5,trace_AUC_ioncc_m6,...
          trace_AUC_sham_m1,trace_AUC_sham_m2,trace_AUC_sham_m3,trace_AUC_sham_m4,trace_AUC_sham_m5,trace_AUC_sham_m6,trace_AUC_sham_m7];
groups{1} = {'d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3',...
             'd1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3',...
             'd1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3'};
groups{2} = {'m1','m1','m1','m2','m2','m2','m3','m3','m3','m4','m4','m4','m5','m5','m5',...
             'm6','m6','m6','m7','m7','m7','m8','m8','m8','m9','m9','m9','m10','m10','m10',...
             'm11','m11','m11','m12','m12','m12','m13','m13','m13','m14','m14','m14','m15','m15','m15'};
groups{2} = {'RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE',...
             'IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC'...,'IONCC','IONCC','IONCC',...
             'SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM'};%,'SHAM','SHAM','SHAM','SHAM','SHAM','SHAM'};

groups{2} = {'RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE',...
             'CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL',...
             'CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL','CONTROL'};

[p,tbl,stats] = anovan(y_vals, groups, 'model','interaction','varnames',{'Days','Groups'});
figure;
results = multcompare(stats,'Dimension',[1 2])

% ANOVA analysis
%     y_vals = [tot_AUC_m1,tot_AUC_m2,tot_AUC_m3,tot_AUC_m4,tot_AUC_m5,...
%               tot_AUC_ioncc_m1,tot_AUC_ioncc_m2,tot_AUC_ioncc_m3,tot_AUC_ioncc_m4,tot_AUC_ioncc_m5,tot_AUC_ioncc_m6,...
%               tot_AUC_sham_m1,tot_AUC_sham_m2,tot_AUC_sham_m3,tot_AUC_sham_m4,tot_AUC_sham_m5,tot_AUC_sham_m6,tot_AUC_sham_m7];
%     groups{1} = {'d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3',...
%                  'd1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3',...
%                  'd1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3','d1','d2','d3'};
% %     groups{2} = {'m1','m1','m1','m2','m2','m2','m3','m3','m3','m4','m4','m4','m5','m5','m5'};
%     groups{2} = {'RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE','RITE',...
%                  'IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC','IONCC',...
%                  'SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM','SHAM'};
%     
%     [p,tbl,stats] = anovan(y_vals, groups, 'model','interaction','varnames',{'Days','Groups'});
%     figure;
%     results = multcompare(stats,'Dimension',[1 2])


%     disp('Ion-CC');
%     [~,p1] = ttest2jjj([frac_global_m1(1);frac_global_m2(1);frac_global_m3(1)], [frac_global_ioncc_m1(1);frac_global_ioncc_m2(1);frac_global_ioncc_m3(1)])
%     [~,p4] = ttest2([frac_global_m1(4);frac_global_m2(4);frac_global_m3(4)], [frac_global_ioncc_m1(4);frac_global_ioncc_m2(4);frac_global_ioncc_m3(4)])
%     [~,p5] = ttest2([frac_global_m1(5);frac_global_m2(5);frac_global_m3(5)], [frac_global_ioncc_m1(5);frac_global_ioncc_m2(5);frac_global_ioncc_m3(5)])
%     [~,p6] = ttest2([frac_global_m1(6);frac_global_m2(6);frac_global_m3(6)], [frac_global_ioncc_m1(6);frac_global_ioncc_m2(6);frac_global_ioncc_m3(6)])
%     disp('Sham');
%     [~,p1] = ttest2([frac_global_m1(1);frac_global_m2(1);frac_global_m3(1)], [frac_global_sham_m1(1);frac_global_sham_m2(1);frac_global_sham_m3(1)])
%     [~,p4] = ttest2([frac_global_m1(4);frac_global_m2(4);frac_global_m3(4)], [frac_global_sham_m1(4);frac_global_sham_m2(4);frac_global_sham_m3(4)])
%     [~,p5] = ttest2([frac_global_m1(5);frac_global_m2(5);frac_global_m3(5)], [frac_global_sham_m1(5);frac_global_sham_m2(5);frac_global_sham_m3(5)])
%     [~,p6] = ttest2([frac_global_m1(6);frac_global_m2(6);frac_global_m3(6)], [frac_global_sham_m1(6);frac_global_sham_m2(6);frac_global_sham_m3(6)])

function plot_appearance(ax)
%     box(ax,'off');
    ax.Box = 'off';
    ax.LineWidth = 1;
    ax.TickDir = 'out';
    ax.FontName = 'Arial';
    ax.FontSize = 8;
end

function [frac_global,num_transients,global_AUC,ind_AUC,sum_events,tot_AUC,trace_AUC] = group_graphs(file_list, norm_res)

    frac_global = zeros(length(file_list),3);
    num_transients = zeros(length(file_list),3);
    global_AUC = zeros(length(file_list),3);
    ind_AUC = zeros(length(file_list),3);
    sum_events = zeros(length(file_list),3);
    tot_AUC = zeros(length(file_list),3);
    trace_AUC = zeros(length(file_list),3);
    for i=1:length(file_list)
        [frac_global(i,:),num_transients(i,:),global_AUC(i,:),ind_AUC(i,:),sum_events(i,:),tot_AUC(i,:),trace_AUC(i,:)] = plot_CORR(file_list{i}, sprintf('Dlx Com-TN %d',i));
    end

    figure();
    ax1 = subplot(3,2,1);
    plot(frac_global','LineWidth',2,'Color','#CCCCCC');
    hold on;
    plot(mean(frac_global) ,'LineWidth',3, 'Color', 'k');
    title('Fraction global');
    hold off;

    ylim([0,1]);
    xticks([1,2,3]);
    xticklabels({'Day 0';'Day 3';'Day 7'});
    xtickangle(45);

    ax1.LineWidth = 2;
    ax1.Box = false;
    ax1.TickDir = 'out';

    

    ax2 = subplot(3,2,2);
    plot(num_transients','LineWidth',2,'Color','#CCCCCC');
    hold on;
    plot(nanmean(num_transients) ,'LineWidth',3, 'Color', 'k');
    title('Number of transients');
    hold off;

    ylim([0,100]);
    xticks([1,2,3]);
    xticklabels({'Day 0';'Day 3';'Day 7'});
    xtickangle(45);

    ax2.LineWidth = 2;
    ax2.Box = false;
    ax2.TickDir = 'out';

    
    ax3 = subplot(3,2,3);
    plot(global_AUC','LineWidth',2,'Color','#CCCCCC');
    hold on;
    plot(nanmean(global_AUC) ,'LineWidth',3, 'Color', 'k');
    title('AUC global');
    hold off;

    ylim([0,100]);
    xticks([1,2,3,4,5,6]);
    xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
    xtickangle(45);

    ax3.LineWidth = 2;
    ax3.Box = false;
    ax3.TickDir = 'out';

    

    ax4 = subplot(3,2,4);
    plot(ind_AUC','LineWidth',2,'Color','#CCCCCC');
    hold on;
    plot(nanmean(ind_AUC) ,'LineWidth',3, 'Color', 'k');
    title('AUC independent');
    hold off;

    ylim([0,100]);
    xticks([1,2,3,4,5,6]);
    xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
    xtickangle(45);

    ax4.LineWidth = 2;
    ax4.Box = false;
    ax4.TickDir = 'out';

    

    if norm_res == true
        for i=1:size(trace_AUC,1)
            trace_AUC(i,:) = trace_AUC(i,:)/max(trace_AUC(i,:));
        end
    end
    ax5 = subplot(3,2,5);
    plot(trace_AUC','LineWidth',2,'Color','#CCCCCC');
    hold on;
    plot(nanmean(trace_AUC) ,'LineWidth',3, 'Color', 'k');
    title('Trace AUC');
    hold off;

%     ylim([0,1]);
    xticks([1,2,3]);
    xticklabels({'Day 0';'Day 3';'Day 7'});
    xtickangle(45);

    ax5.LineWidth = 2;
    ax5.Box = false;
    ax5.TickDir = 'out';

    
    if norm_res == true
        for i=1:size(tot_AUC,1)
            tot_AUC(i,:) = tot_AUC(i,:)/max(tot_AUC(i,:));
        end
    end
    ax6 = subplot(3,2,6);
    plot(tot_AUC','LineWidth',2,'Color','#CCCCCC');
    hold on;
    plot(nanmean(tot_AUC) ,'LineWidth',3, 'Color', 'k');
    title('total AUC');
    hold off;

    %     ylim([0,2000]);
    xticks([1,2,3]);
    xticklabels({'Day 0';'Day 3';'Day 7'});
    xtickangle(45);

    ax6.LineWidth = 2;
    ax6.Box = false;
    ax6.TickDir = 'out';
end

function trace_AUC = get_trace_AUC(plot_files)
    auc_data = cell(length(plot_files),1);
    trace_AUC = cell(length(plot_files),length(plot_files{1}));
    
    for i=1:length(plot_files)
        for j=1:length(plot_files{i})
            auc_data{i} = load(strcat(plot_files{i}{j},'_AUC.mat'));
            trace_AUC{i,j} = auc_data{i}.AUC_fulltrace;
        end
    end
end

function [frac_global,num_transients,global_AUC,ind_AUC,sum_events, tot_AUC, trace_AUC] = plot_CORR(plot_files, plot_title)

    auc_data = cell(length(plot_files),1);
    roi_data = cell(length(plot_files),1);
    
    
    mean_frac_global = cell(length(plot_files),1);
    mean_num_transients = cell(length(plot_files),1);
    mean_num_ind_transients = cell(length(plot_files),1);
    mean_num_global_transients = cell(length(plot_files),1);
    
    
    frac_global = [];
    num_transients = [];
    num_ind_transients = [];
    num_global_transients = [];
    global_AUC = [];
    ind_AUC = [];
    sum_events = [];
    tot_AUC = [];
    trace_AUC = [];
    
    for i=1:length(plot_files)
         if ~strcmp(plot_files{i}, '')
            disp(plot_files{i});
            auc_data{i} = load(strcat(plot_files{i},'_AUC.mat'));
            roi_data{i} = load(strcat(plot_files{i},'_analyzed.mat'));
            

            event_count = zeros(size(roi_data{i}.foopsi_events));
            event_count(roi_data{i}.foopsi_events > 0.3) = 1; 
            sum_events = [sum_events, sum(sum( event_count ))];
            frac_global = [frac_global, nanmean(auc_data{i}.fraction_global_transients)];
            num_transients = [num_transients, nanmean(auc_data{i}.tot_num_transients)];
            num_ind_transients = [num_ind_transients, nanmean(auc_data{i}.tot_num_transients) - nanmean(auc_data{i}.num_global_transients)];
            num_global_transients = [num_global_transients, nanmean(auc_data{i}.num_global_transients)];

            global_AUC = [global_AUC, nanmean(auc_data{i}.tot_AUC_global)];
            ind_AUC = [ind_AUC, nanmean(auc_data{i}.tot_AUC_ind)];
            tot_AUC = [tot_AUC, nansum(auc_data{i}.tot_AUC_ind) + nansum(auc_data{i}.tot_AUC_global)];
            trace_AUC = [trace_AUC, nanmean(auc_data{i}.AUC_fulltrace)];
            
         else
             global_AUC = [global_AUC, NaN];
             ind_AUC = [ind_AUC, NaN];
             frac_global = [frac_global, NaN];
             num_transients = [num_transients, NaN];
             sum_events = [sum_events, NaN];
             
         end

    end
    
    figure();
    ax1 = subplot(3,2,1);
    plot(ax1,frac_global);
    ylabel('fraction global');
    title(plot_title);
    
    ax2 = subplot(3,2,2);
    plot(ax2,num_transients);
    ylabel('total # of transients');
    
    ax3 = subplot(3,2,3);
    plot(ax3,global_AUC);
    ylabel('AUC of global transients');
    
    ax4 = subplot(3,2,4);
    plot(ax4,ind_AUC);
    ylabel('AUC of ind transients');
    
    ax5 = subplot(3,2,5);
    plot(ax5,sum_events);
    ylabel('sum of events');
    
    ax6 = subplot(3,2,6);
    plot(ax6,tot_AUC);
    ylabel('total AUC');
    
    close()
   
    
%     scatter(geomean_vs_corr, geomean1(:), pwcorr1(:), 'MarkerEdgeColor', 'k');
%     hold(geomean_vs_corr,'on');
%     plot(geomean_vs_corr,geomean1(:),brob1(1)+brob1(2)*geomean1(:),'k');
%     scatter(geomean_vs_corr, geomean2(:), pwcorr2(:), 'MarkerEdgeColor', 'r');
%     plot(geomean_vs_corr,geomean2(:),brob2(1)+brob2(2)*geomean2(:),'r');
%     hold(geomean_vs_corr,'off');
end

function plot_shade(ax, x_data, y_data, col)
%     str = '#FF0000';
    col2 = sscanf(col(2:end),'%2x%2x%2x',[1 3])/255;   % stupid fucking workaround for Matlab not being able to use hexcodes everywhere
    fill(ax, [x_data, fliplr(x_data)], [mean(y_data,2)' + (std(y_data,0,2)' ./ sqrt(length(y_data))'), fliplr(mean(y_data,2)' - (std(y_data,0,2)' ./ sqrt(length(y_data))'))], col2, 'FaceAlpha',.3, 'EdgeColor','none');
end

% [frac_global_m1,num_transients_m1,global_AUC_m1,ind_AUC_m1,sum_events_m1, tot_AUC_m1, trace_AUC_m1] = plot_CORR(Dlx_RITE_m1, 'Dlx Com-TN M1');
% [frac_global_m2,num_transients_m2,global_AUC_m2,ind_AUC_m2,sum_events_m2, tot_AUC_m2, trace_AUC_m2] = plot_CORR(Dlx_RITE_m2, 'Dlx Com-TN M2');
% [frac_global_m3,num_transients_m3,global_AUC_m3,ind_AUC_m3,sum_events_m3, tot_AUC_m3, trace_AUC_m3] = plot_CORR(Dlx_RITE_m3, 'Dlx Com-TN M3');
% [frac_global_m4,num_transients_m4,global_AUC_m4,ind_AUC_m4,sum_events_m4, tot_AUC_m4, trace_AUC_m4] = plot_CORR(Dlx_RITE_m4, 'Dlx Com-TN M4');
% [frac_global_m5,num_transients_m5,global_AUC_m5,ind_AUC_m5,sum_events_m5, tot_AUC_m5, trace_AUC_m5] = plot_CORR(Dlx_RITE_m5, 'Dlx Com-TN M5');
%     [frac_global_m6,num_transients_m6,global_AUC_m6,ind_AUC_m6] = plot_CORR(Dlx_RITE_m6, 'Dlx Com-TN M6');
%     [frac_global_m7,num_transients_m7,global_AUC_m7,ind_AUC_m7] = plot_CORR(Dlx_RITE_m7, 'Dlx Com-TN M7');
%     [frac_global_m8,num_transients_m8,global_AUC_m8,ind_AUC_m8] = plot_CORR(Dlx_RITE_m8, 'Dlx Com-TN M8');
%     [frac_global_m9,num_transients_m9,global_AUC_m9,ind_AUC_m9] = plot_CORR(Dlx_RITE_m9, 'Dlx Com-TN M9');
%     [frac_global_m10,num_transients_m10,global_AUC_m10,ind_AUC_m10] = plot_CORR(Dlx_RITE_m10, 'Dlx Com-TN M10');
%    
%% 

%     Dlx_RITE_old_m1 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 1/day 0/T8';...
%                        'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 1/day 3/T8';...
%                        'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 1/day 7/T8'};
%                    
%     Dlx_RITE_old_m2 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 2/day 0/T9';...
%                      'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 2/day 3/T9_rigid';...
%                      'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 2/day 7/T9'};
%                    
%     Dlx_RITE_old_m3 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 3/day 0/10';...
%                  'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 3/day 3/T10';...
%                  'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 3/day 7/T10'};    
% 
%     Dlx_RITE_old_m4 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 4/day 0/T11';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 4/day 3/T11';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 4/day 7/T11'};
%          
%     Dlx_RITE_old_m5 = { 'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 5/day 0/T';...
%             'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 5/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 5/day 7/T'};
%          
%     Dlx_RITE_old_m6 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 6/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 6/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 6/day 7/T'};
%             
%     Dlx_RITE_old_m7 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 7/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 7/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 7/day 7/T'};
%         
%     Dlx_RITE_old_m8 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 8/day 0/T_rigid';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 8/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 8/day 7/T'};
%           
%     Dlx_RITE_old_m9 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 9/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 9/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 9/day 7/T'};
%           
%     Dlx_RITE_old_m10 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 10/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 10/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/RITE old/Mouse 10/day 7/T'};       

          
       
%     Dlx_Sham_m5 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 5/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 5/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 5/day 7/T_rigid'};
%         
%     Dlx_Sham_m6 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 6/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 6/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 6/day 7/T'};
%        
%     Dlx_Sham_m7 = {'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 7/day 0/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 7/day 3/T';...
%              'C:\Users\lfisc\Work\Projects/Shiqian/Dlx data/Sham/Mouse 7/day 7/T'};


% [frac_global_ioncc_m1,num_transients_ioncc_m1,global_AUC_ioncc_m1,ind_AUC_ioncc_m1, sum_events_ioncc_m1, tot_AUC_ioncc_m1, trace_AUC_ioncc_m1] = plot_CORR(Dlx_Ion_CC_m1, 'Ion-CC M1');
% [frac_global_ioncc_m2,num_transients_ioncc_m2,global_AUC_ioncc_m2,ind_AUC_ioncc_m2, sum_events_ioncc_m2, tot_AUC_ioncc_m2, trace_AUC_ioncc_m2] = plot_CORR(Dlx_Ion_CC_m2, 'Ion-CC M2');
% [frac_global_ioncc_m3,num_transients_ioncc_m3,global_AUC_ioncc_m3,ind_AUC_ioncc_m3, sum_events_ioncc_m3, tot_AUC_ioncc_m3, trace_AUC_ioncc_m3] = plot_CORR(Dlx_Ion_CC_m3, 'Ion-CC M3');
% [frac_global_ioncc_m4,num_transients_ioncc_m4,global_AUC_ioncc_m4,ind_AUC_ioncc_m4, sum_events_ioncc_m4, tot_AUC_ioncc_m4, trace_AUC_ioncc_m4] = plot_CORR(Dlx_Ion_CC_m4, 'Ion-CC M4');
% [frac_global_ioncc_m5,num_transients_ioncc_m5,global_AUC_ioncc_m5,ind_AUC_ioncc_m5, sum_events_ioncc_m5, tot_AUC_ioncc_m5, trace_AUC_ioncc_m5] = plot_CORR(Dlx_Ion_CC_m5, 'Ion-CC M5');
% [frac_global_ioncc_m6,num_transients_ioncc_m6,global_AUC_ioncc_m6,ind_AUC_ioncc_m6, sum_events_ioncc_m6, tot_AUC_ioncc_m6, trace_AUC_ioncc_m6] = plot_CORR(Dlx_Ion_CC_m6, 'Ion-CC M6');
% 
% figure();
% ax1 = subplot(3,2,1);
% plot(frac_global_ioncc_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(frac_global_ioncc_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_ioncc_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_ioncc_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_ioncc_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_ioncc_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([frac_global_ioncc_m1;frac_global_ioncc_m2;frac_global_ioncc_m3;frac_global_ioncc_m4;frac_global_ioncc_m5;frac_global_ioncc_m6]) ,'LineWidth',3, 'Color', 'k');
% title('Fraction global');
% hold off;
% 
% ylim([0,1]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax1.LineWidth = 2;
% ax1.Box = false;
% ax1.TickDir = 'out';
% 
% ax2 = subplot(3,2,2);
% plot(num_transients_ioncc_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(num_transients_ioncc_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_ioncc_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_ioncc_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_ioncc_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_ioncc_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([num_transients_ioncc_m1;num_transients_ioncc_m2;num_transients_ioncc_m3;num_transients_ioncc_m4;num_transients_ioncc_m5;num_transients_ioncc_m6]) ,'LineWidth',3, 'Color', 'k');
% title('Number of transients');
% hold off;
% 
% ylim([0,100]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax2.LineWidth = 2;
% ax2.Box = false;
% ax2.TickDir = 'out';
% 
% ax3 = subplot(3,2,3);
% plot(global_AUC_ioncc_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(global_AUC_ioncc_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_ioncc_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_ioncc_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_ioncc_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_ioncc_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([global_AUC_ioncc_m1;global_AUC_ioncc_m2;global_AUC_ioncc_m3;global_AUC_ioncc_m4;global_AUC_ioncc_m5;global_AUC_ioncc_m6]) ,'LineWidth',3, 'Color', 'k');
% title('AUC global');
% hold off;
% 
% ylim([0,100]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax3.LineWidth = 2;
% ax3.Box = false;
% ax3.TickDir = 'out';
% 
% ax4 = subplot(3,2,4);
% plot(ind_AUC_ioncc_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(ind_AUC_ioncc_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_ioncc_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_ioncc_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_ioncc_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_ioncc_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([ind_AUC_ioncc_m1;ind_AUC_ioncc_m2;ind_AUC_ioncc_m3;ind_AUC_ioncc_m4;ind_AUC_ioncc_m5;ind_AUC_ioncc_m6]) ,'LineWidth',3, 'Color', 'k');
% title('AUC independent');
% hold off;
% 
% ylim([0,100]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax4.LineWidth = 2;
% ax4.Box = false;
% ax4.TickDir = 'out';
% 
% if norm_res == true
%     trace_AUC_ioncc_m1 = trace_AUC_ioncc_m1/max(trace_AUC_ioncc_m1);
%     trace_AUC_ioncc_m2 = trace_AUC_ioncc_m2/max(trace_AUC_ioncc_m2);
%     trace_AUC_ioncc_m3 = trace_AUC_ioncc_m3/max(trace_AUC_ioncc_m3);
%     trace_AUC_ioncc_m4 = trace_AUC_ioncc_m4/max(trace_AUC_ioncc_m4);
%     trace_AUC_ioncc_m5 = trace_AUC_ioncc_m5/max(trace_AUC_ioncc_m5);
%     trace_AUC_ioncc_m6 = trace_AUC_ioncc_m6/max(trace_AUC_ioncc_m6);
% end
% ax5 = subplot(3,2,5);
% plot(trace_AUC_ioncc_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(trace_AUC_ioncc_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_ioncc_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_ioncc_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_ioncc_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_ioncc_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([trace_AUC_ioncc_m1;trace_AUC_ioncc_m2;trace_AUC_ioncc_m3;trace_AUC_ioncc_m4;trace_AUC_ioncc_m5;trace_AUC_ioncc_m6]) ,'LineWidth',3, 'Color', 'k');
% title('Trace AUC');
% hold off;
% 
% ylim([0,1]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax5.LineWidth = 2;
% ax5.Box = false;
% ax5.TickDir = 'out';
% 
% if norm_res == true
%     tot_AUC_ioncc_m1 = tot_AUC_ioncc_m1/max(tot_AUC_ioncc_m1);
%     tot_AUC_ioncc_m2 = tot_AUC_ioncc_m2/max(tot_AUC_ioncc_m2);
%     tot_AUC_ioncc_m3 = tot_AUC_ioncc_m3/max(tot_AUC_ioncc_m3);
%     tot_AUC_ioncc_m4 = tot_AUC_ioncc_m4/max(tot_AUC_ioncc_m4);
%     tot_AUC_ioncc_m5 = tot_AUC_ioncc_m5/max(tot_AUC_ioncc_m5);
%     tot_AUC_ioncc_m6 = tot_AUC_ioncc_m6/max(tot_AUC_ioncc_m6);
% end
% ax6 = subplot(3,2,6);
% plot(tot_AUC_ioncc_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(tot_AUC_ioncc_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_ioncc_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_ioncc_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_ioncc_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_ioncc_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([tot_AUC_ioncc_m1;tot_AUC_ioncc_m2;tot_AUC_ioncc_m3;tot_AUC_ioncc_m4;tot_AUC_ioncc_m5;tot_AUC_ioncc_m6]) ,'LineWidth',3, 'Color', 'k');
% title('tot AUC');
% hold off;
% 
% %     ylim([0,2000]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax6.LineWidth = 2;
% ax6.Box = false;
% ax6.TickDir = 'out';
% 
% 
% [frac_global_sham_m1,num_transients_sham_m1,global_AUC_sham_m1,ind_AUC_sham_m1, sum_events_sham_m1, tot_AUC_sham_m1, trace_AUC_sham_m1] = plot_CORR(Dlx_Sham_m1, 'SHAM M1');
% [frac_global_sham_m2,num_transients_sham_m2,global_AUC_sham_m2,ind_AUC_sham_m2, sum_events_sham_m2, tot_AUC_sham_m2, trace_AUC_sham_m2] = plot_CORR(Dlx_Sham_m2, 'SHAM M2');
% [frac_global_sham_m3,num_transients_sham_m3,global_AUC_sham_m3,ind_AUC_sham_m3, sum_events_sham_m3, tot_AUC_sham_m3, trace_AUC_sham_m3] = plot_CORR(Dlx_Sham_m3, 'SHAM M3');
% [frac_global_sham_m4,num_transients_sham_m4,global_AUC_sham_m4,ind_AUC_sham_m4, sum_events_sham_m4, tot_AUC_sham_m4, trace_AUC_sham_m4] = plot_CORR(Dlx_Sham_m4, 'SHAM M4');
% [frac_global_sham_m5,num_transients_sham_m5,global_AUC_sham_m5,ind_AUC_sham_m5, sum_events_sham_m5, tot_AUC_sham_m5, trace_AUC_sham_m5] = plot_CORR(Dlx_Sham_m5, 'SHAM M5');
% [frac_global_sham_m6,num_transients_sham_m6,global_AUC_sham_m6,ind_AUC_sham_m6, sum_events_sham_m6, tot_AUC_sham_m6, trace_AUC_sham_m6] = plot_CORR(Dlx_Sham_m6, 'SHAM M6');
% [frac_global_sham_m7,num_transients_sham_m7,global_AUC_sham_m7,ind_AUC_sham_m7, sum_events_sham_m7, tot_AUC_sham_m7, trace_AUC_sham_m7] = plot_CORR(Dlx_Sham_m7, 'SHAM M7');
% 
% figure();
% ax1 = subplot(3,2,1);
% plot(frac_global_sham_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(frac_global_sham_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_sham_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_sham_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_sham_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_sham_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(frac_global_sham_m7,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([frac_global_sham_m1;frac_global_sham_m2;frac_global_sham_m3;frac_global_sham_m4;frac_global_sham_m5;frac_global_sham_m6;frac_global_sham_m7]) ,'LineWidth',3, 'Color', 'k');
% title('Fraction global');
% hold off;
% 
% ylim([0,1]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax1.LineWidth = 2;
% ax1.Box = false;
% ax1.TickDir = 'out';
% 
% ax2 = subplot(3,2,2);
% plot(num_transients_sham_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(num_transients_sham_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_sham_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_sham_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_sham_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_sham_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(num_transients_sham_m7,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([num_transients_sham_m1;num_transients_sham_m2;num_transients_sham_m3;num_transients_sham_m4;num_transients_sham_m5;num_transients_sham_m6;num_transients_sham_m7]) ,'LineWidth',3, 'Color', 'k');
% title('Number of transients');
% hold off;
% 
% ylim([0,100]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax2.LineWidth = 2;
% ax2.Box = false;
% ax2.TickDir = 'out';
% 
% ax3 = subplot(3,2,3);
% plot(global_AUC_sham_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(global_AUC_sham_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_sham_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_sham_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_sham_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_sham_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(global_AUC_sham_m7,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([global_AUC_sham_m1;global_AUC_sham_m2;global_AUC_sham_m3;global_AUC_sham_m4;global_AUC_sham_m5;global_AUC_sham_m6;global_AUC_sham_m7]) ,'LineWidth',3, 'Color', 'k');
% title('AUC global');
% hold off;
% 
% ylim([0,100]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax3.LineWidth = 2;
% ax3.Box = false;
% ax3.TickDir = 'out';
% 
% ax4 = subplot(3,2,4);
% plot(ind_AUC_sham_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(ind_AUC_sham_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_sham_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_sham_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_sham_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_sham_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(ind_AUC_sham_m7,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([ind_AUC_sham_m1;ind_AUC_sham_m2;ind_AUC_sham_m3;ind_AUC_sham_m4;ind_AUC_sham_m5;ind_AUC_sham_m6;ind_AUC_sham_m7]) ,'LineWidth',3, 'Color', 'k');
% title('AUC independent');
% hold off;
% 
% ylim([0,100]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax4.LineWidth = 2;
% ax4.Box = false;
% ax4.TickDir = 'out';
% 
% if norm_res == true
%     trace_AUC_sham_m1 = trace_AUC_sham_m1/max(trace_AUC_sham_m1);
%     trace_AUC_sham_m2 = trace_AUC_sham_m2/max(trace_AUC_sham_m2);
%     trace_AUC_sham_m3 = trace_AUC_sham_m3/max(trace_AUC_sham_m3);
%     trace_AUC_sham_m4 = trace_AUC_sham_m4/max(trace_AUC_sham_m4);
%     trace_AUC_sham_m5 = trace_AUC_sham_m5/max(trace_AUC_sham_m5);
%     trace_AUC_sham_m6 = trace_AUC_sham_m6/max(trace_AUC_sham_m6);
%     trace_AUC_sham_m7 = trace_AUC_sham_m7/max(trace_AUC_sham_m7);
% end
% ax5 = subplot(3,2,5);
% plot(trace_AUC_sham_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(trace_AUC_sham_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_sham_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_sham_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_sham_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_sham_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(trace_AUC_sham_m7,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([trace_AUC_sham_m1;trace_AUC_sham_m2;trace_AUC_sham_m3;trace_AUC_sham_m4;trace_AUC_sham_m5;trace_AUC_sham_m6;trace_AUC_sham_m7]) ,'LineWidth',3, 'Color', 'k');
% title('Trace AUC');
% hold off;
% 
% ylim([0,1]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax5.LineWidth = 2;
% ax5.Box = false;
% ax5.TickDir = 'out';
% 
% if norm_res == true
%     tot_AUC_sham_m1 = tot_AUC_sham_m1/max(tot_AUC_sham_m1);
%     tot_AUC_sham_m2 = tot_AUC_sham_m2/max(tot_AUC_sham_m2);
%     tot_AUC_sham_m3 = tot_AUC_sham_m3/max(tot_AUC_sham_m3);
%     tot_AUC_sham_m4 = tot_AUC_sham_m4/max(tot_AUC_sham_m4);
%     tot_AUC_sham_m5 = tot_AUC_sham_m5/max(tot_AUC_sham_m5);
%     tot_AUC_sham_m6 = tot_AUC_sham_m6/max(tot_AUC_sham_m6);
%     tot_AUC_sham_m7 = tot_AUC_sham_m7/max(tot_AUC_sham_m7);
% end
% ax6 = subplot(3,2,6);
% plot(tot_AUC_sham_m1,'LineWidth',2,'Color','#CCCCCC');
% hold on;
% plot(tot_AUC_sham_m2,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_sham_m3,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_sham_m4,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_sham_m5,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_sham_m6,'LineWidth',2,'Color','#CCCCCC');
% plot(tot_AUC_sham_m7,'LineWidth',2,'Color','#CCCCCC');
% plot(nanmean([tot_AUC_sham_m1;tot_AUC_sham_m2;tot_AUC_sham_m3;tot_AUC_sham_m4;tot_AUC_sham_m5;tot_AUC_sham_m6;tot_AUC_sham_m7]) ,'LineWidth',3, 'Color', 'k');
% title('tot AUC');
% hold off;
% 
% %     ylim([0,2000]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% 
% ax5.LineWidth = 2;
% ax5.Box = false;
% ax5.TickDir = 'out';
% 
% %     
% figure('Position',[10 10 200 400]);
% ax5 = subplot(1,1,1);
% errorbar(nanmean([tot_AUC_m1;tot_AUC_m2;tot_AUC_m3;tot_AUC_m4;tot_AUC_m5]),...
%          nanstd([tot_AUC_m1;tot_AUC_m2;tot_AUC_m3;tot_AUC_m4;tot_AUC_m5])/sqrt(5) ,'LineWidth',3, 'Color', 'r');
% % ;tot_AUC_m6;tot_AUC_m7;tot_AUC_m8;tot_AUC_m9;tot_AUC_m10
% 
% hold on;
% errorbar(nanmean([tot_AUC_ioncc_m1;tot_AUC_ioncc_m2;tot_AUC_ioncc_m3;tot_AUC_ioncc_m4;tot_AUC_ioncc_m5;tot_AUC_ioncc_m6]),... 
%          nanstd([tot_AUC_ioncc_m1;tot_AUC_ioncc_m2;tot_AUC_ioncc_m3;tot_AUC_ioncc_m4;tot_AUC_ioncc_m5;tot_AUC_ioncc_m6])/sqrt(6) ,'LineWidth',3, 'Color', 'b');
% errorbar(nanmean([tot_AUC_sham_m1;tot_AUC_sham_m2;tot_AUC_sham_m3;tot_AUC_sham_m4;tot_AUC_sham_m5;tot_AUC_sham_m6;tot_AUC_sham_m7]),...
%          nanstd([tot_AUC_sham_m1;tot_AUC_sham_m2;tot_AUC_sham_m3;tot_AUC_sham_m4;tot_AUC_sham_m5;tot_AUC_sham_m6;tot_AUC_sham_m7])/sqrt(7) ,'LineWidth',3, 'Color', 'k');
% hold off;
% 
% %     ylim([0,0.8]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% ylabel('Total AUC');
% 
% ax5.LineWidth = 2;
% ax5.Box = false;
% ax5.TickDir = 'out';
% 
% figure('Position',[210 10 200 400]);
% ax5 = subplot(1,1,1);
% errorbar(nanmean([trace_AUC_m1;trace_AUC_m2;trace_AUC_m3;trace_AUC_m4;trace_AUC_m5]),...
%          nanstd([trace_AUC_m1;trace_AUC_m2;trace_AUC_m3;trace_AUC_m4;trace_AUC_m5])/sqrt(5) ,'LineWidth',3, 'Color', 'r');
% % ;trace_AUC_m6;trace_AUC_m7;trace_AUC_m8;trace_AUC_m9;trace_AUC_m10
% 
% hold on;
% errorbar(nanmean([trace_AUC_ioncc_m1;trace_AUC_ioncc_m2;trace_AUC_ioncc_m3;trace_AUC_ioncc_m4;trace_AUC_ioncc_m5;trace_AUC_ioncc_m6]),... 
%          nanstd([trace_AUC_ioncc_m1;trace_AUC_ioncc_m2;trace_AUC_ioncc_m3;trace_AUC_ioncc_m4;trace_AUC_ioncc_m5;trace_AUC_ioncc_m6])/sqrt(6) ,'LineWidth',3, 'Color', 'b');
% errorbar(nanmean([trace_AUC_sham_m1;trace_AUC_sham_m2;trace_AUC_sham_m3;trace_AUC_sham_m4;trace_AUC_sham_m5;trace_AUC_sham_m6;trace_AUC_sham_m7]),...
%          nanstd([trace_AUC_sham_m1;trace_AUC_sham_m2;trace_AUC_sham_m3;trace_AUC_sham_m4;trace_AUC_sham_m5;trace_AUC_sham_m6;trace_AUC_sham_m7])/sqrt(7) ,'LineWidth',3, 'Color', 'k');
% hold off;
% 
% %     ylim([0,0.8]);
% xticks([1,2,3,4,5,6]);
% xticklabels({'Day 0';'Day 3';'Day 7';'Day 14';'Day 21';'Day 28'});
% xtickangle(45);
% ylabel('Trace AUC');
% 
% ax5.LineWidth = 2;
% ax5.Box = false;
% ax5.TickDir = 'out';